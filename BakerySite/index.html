<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakerySite</title>

    <style>
        /* Chrome, Safari, Edge, Opera */
        .settings-box input::-webkit-outer-spin-button,
        .settings-box input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        .settings-box input[type=number] {
            -moz-appearance: textfield;
        }
    </style>

    <link rel="icon" type="image/png" href="images/BreadIcon.png"/> <!--favicon next to website title-->
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body background="images/BreadBack.jfif" style="background-repeat: no-repeat; background-size: cover; background-attachment: fixed;">
    <!--Navbar at the top of the page-->
    <nav id="divNavbar" class="navbar navbar-expand-lg bg-primary">
        <div class="container-fluid col-6">
            <a class="navbar-brand text-light fs-1" href="#">
                <img src="images/BreadIcon.png" alt="BakerySite logo" width="50" height="50">
                BakerySite
            </a>
        </div>
      <!--<a id="btnAbout" class="text-light fs-3 mx-3" href="#">About</a>-->
      <div class="col-6 d-flex justify-content-end">
        <button id="btnHamburger" title="btnHamburger" class="btn dropdown-toggle " type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi-list text-light fs-1"> </i>
        </button>
    
        <ul id="dropDownMenu" class="dropdown-menu dropdown-menu-end">
            <li><button id="btnAbout" class="dropdown-item position-relative" type="button">About</button></li>
            <li><button id="btnLogout" class="dropdown-item position-relative" type="button" style="display: none;">Logout</button></li>
        </ul>
    
      </div>
            
    </nav>

 
    <style>
        .err { background: #ffe6ee; border: 1px solid #b1395f; }
        .emsg { color: #c12020; font-weight: bold; }
    </style>    

    <style>
        #audioButton {
            background-color: transparent;
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center; 
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            position: relative; 
        }

        #soundImage, #noSoundImage{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px; 
            height: 100px; 
        
        }
    </style>

    <!-- Central Card -->
    <div class="d-flex align-items-center justify-content-center">
        <!--Login Form-->
        <div id="divLogin" class="card col-10 col-md-8 col-lg-6 mt-3">
            <div class="card-header">
                <h2 class="text-center">Login</h2>
            </div>
            <div class="card-body">
                <form>
                    <div class="form-floating mb-3" > <!--username/email-->
                        <input id="txtLoginUsername" type="text" class="form-control" placeholder="Username or Email" onfocusout="check(document.getElementById('txtLoginUsername'), document.getElementById('errLoginUsername') )" required minlength="1" maxlength="99">
                        <label for="txtLoginUsername" class="form-label text-black">Username or Email</label>
                    <div id="errLoginUsername" class="emsg"></div>
                    </div> 
                    <div class="form-floating mb-3" required minlength="1"> <!--password-->
                        <input id="txtLoginPassword" type="password" class="form-control" placeholder="Password"  onfocusout="check(document.getElementById('txtLoginPassword'), document.getElementById('errLoginPassword') )" required minlength="1" maxlength="99">
                        <label for="txtLoginPassword" class="form-label text-black" aria-label="Password">Password</label>
                    <div id="errLoginPassword" class="emsg"></div>
                    <div id="capsLockWarning" class="emsg" style="display: none;">
                        Caps Lock is on
                    </div>
                    </div>
                    <button id="btnLogin" type="button" class="btn btn-primary col-12 mt-4">Login</button>
                    <div class="text-center mt-4">
                        <a href="#" onclick="return false;" id="btnToggle">Don't have an account? Register here!</a>
                    </div>
                </form>
            </div>
        </div>

        <!--Registration Form-->
        <div id="divRegister" class="card col-10 col-md-8 col-lg-6 mt-3" style="display: none;">
            <div class="card-header">
                <h2 class="text-center">Register</h2>
            </div>
            <div class="card-body">
                <form>
                    <h3 class="mb-3">Personal information</h3>
                    <div class="form-floating mb-3" > <!--username-->
                        <input id="txtRegisterUsername" class="form-control" placeholder="Username" onfocusout="check(document.getElementById('txtRegisterUsername'), document.getElementById('errRegisterUsername') )" required minlength="1" maxlength="99">
                        <label for="txtRegisterUsername" class="form-label text-black" aria-label="Username">Username</label>
                    <div id="errRegisterUsername" class="emsg"></div>
                    </div>
                    <div class="form-floating mb-3" required minlength="1"> <!--password-->
                        <input id="txtRegisterPassword" type="password" class="form-control" placeholder="Password" onfocusout="check(document.getElementById('txtRegisterPassword'), document.getElementById('errRegisterPassword') )" required minlength="1">
                        <label for="txtRegisterPassword" class="form-label text-black" aria-label="Password">Password</label>
                    <div id="errRegisterPassword" class="emsg"></div>
                    </div>
                    <div class="row gx-3">
                        <div class="col">   
                            <div class="form-floating mb-3" required minlength="1">
                                <input id="txtRegisterFirstName" class="form-control" placeholder="First Name" onfocusout="check(document.getElementById('txtRegisterFirstName'), document.getElementById('errRegisterFirstName') )" required minlength="1">
                                <label for="txtRegisterFirstName" class="form-label text-black" aria-label="First Name">First name</label>
                                <div id="errRegisterFirstName" class="emsg"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-floating mb-3" required minlength="1">
                                <input id="txtRegisterLastName" class="form-control" placeholder="Last Name" onfocusout="check(document.getElementById('txtRegisterLastName'), document.getElementById('errRegisterLastNAme') )" required minlength="1">
                                <label for="txtRegisterLastName" class="form-label text-black" aria-label="Last Name">Last name</label>
                                <div id="errRegisterLastName" class="emsg"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-floating mb-3" required minlength="1">     
                        <input id="txtRegisterEmail" class="form-control" placeholder="Email"  required>
                        <label for="txtRegisterEmail" class="form-label text-black" aria-label="Email">Email</label>
                        <div id="errRegisterEmail" class="emsg"></div>
                    </div>
                    <div class="row gx-3">
                        <div class="col">
                            <div class="form-floating mb-3" required length="10">
                                <input id="numRegisterPhone" class="form-control" type="tel" placeholder="Phone Number" onfocusout="check(document.getElementById('numRegisterPhone'), document.getElementById('errRegisterPhone') )" required minlength="1">
                                <label for="numRegisterPhone" class="form-label text-black" aria-label="Phone number">Phone number</label>
                                <div id="errRegisterPhone" class="emsg"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-floating mb-3" required minlength="1">
                                <input id="txtRegisterCoopID" class="form-control" placeholder="Coop ID" onfocusout="check(document.getElementById('txtRegisterCoopID'), document.getElementById('errRegisterCoopID') )" required minlength="1">
                                <label for="txtRegisterCoopID" class="form-label text-black" aria-label="Coop ID">Coop Registration ID</label>
                                <div id="errRegisterCoopID" class="emsg"></div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <h3 class="mb-3">Address</h3>
                    <div class="form-floating mb-3" required minlength="1">
                        <input id="txtRegisterStreetAddress1" class="form-control" placeholder="Street Address 1" onfocusout="check(document.getElementById('txtRegisterStreetAddress1'), document.getElementById('errRegisterStreetAddress1') )" required minlength="1">
                        <label for="txtRegisterStreetAddress1" class="form-label text-black" aria-label="Street Address 1">Street Address 1</label>
                        <div id="errRegisterStreetAddress1" class="emsg"></div>
                    </div>
                    <div class="form-floating mb-3" required minlength="1">
                        <input id="txtRegisterStreetAddress2" class="form-control" placeholder="Street Address 2" onfocusout="check(document.getElementById('txtRegisterStreetAddress2'), document.getElementById('errRegisterStreetAddress2') )" required minlength="1">
                        <label for="txtRegisterStreetAddress2" class="form-label text-black" aria-label="Street Address 2">Street Address 2</label>
                        <div id="errRegisterStreetAddress2" class="emsg"></div>
                    </div>
                    <div class="row gx-3">
                        <div class="col">
                            <div class="form-floating mb-3" required minlength="1">
                                <input id="txtRegisterCity" class="form-control" placeholder="City" onfocusout="check(document.getElementById('txtRegisterCity'), document.getElementById('errRegisterCity') )" required minlength="1">
                                <label for="txtRegisterCity" class="form-label text-black" aria-label="City">City</label>
                                <div id="errRegisterCity" class="emsg"></div>
                            </div>
                        </div>
                        <div class="col">
                            <div>
                                <div class="form-floating mb-3">
                                    <select name="States" id="txtRegisterState" class="form-select" onfocusout="check(document.getElementById('txtRegisterState'), document.getElementById('errRegisterState') )" required><!--don't let them submit while "Select" is selected-->
                                        <option disabled selected value="" selected>Select</option>
                                        <option value="Alabama">AL</option>
                                        <option value="Alaska">AK</option>
                                        <option value="Arizona">AZ</option>
                                        <option value="Arkansas">AR</option>
                                        <option value="California">CA</option>
                                        <option value="Colorado">CO</option>
                                        <option value="Connecticut">CT</option>
                                        <option value="Delaware">DE</option>
                                        <option value="District of Columbia">DC</option>
                                        <option value="Florida">FL</option>
                                        <option value="Georgia">GA</option>
                                        <option value="Hawaii">HI</option>
                                        <option value="Idaho">ID</option>
                                        <option value="Illinois">IL</option>
                                        <option value="Indiana">IN</option>
                                        <option value="Iowa">IA</option>
                                        <option value="Kansas">KS</option>
                                        <option value="Kentucky">KY</option>
                                        <option value="Louisiana">LA</option>
                                        <option value="Maine">ME</option>
                                        <option value="Maryland">MD</option>
                                        <option value="Massachusetts">MA</option>
                                        <option value="Michigan">MI</option>
                                        <option value="Minnesota">MN</option>
                                        <option value="Mississippi">MS</option>
                                        <option value="Missouri">MO</option>
                                        <option value="Montana">MT</option>
                                        <option value="Nebraska">NE</option>
                                        <option value="Nevada">NV</option>
                                        <option value="New Hampshire">NH</option>
                                        <option value="New Jersey">NJ</option>
                                        <option value="New Mexico">NM</option>
                                        <option value="New York">NY</option>
                                        <option value="North Carolina">NC</option>
                                        <option value="North Dakota">ND</option>
                                        <option value="Ohio">OH</option>
                                        <option value="Oklahoma">OK</option>
                                        <option value="Oregon">OR</option>
                                        <option value="Pennsylvania">PA</option>
                                        <option value="Rhode Island">RI</option>
                                        <option value="South Carolina">SC</option>
                                        <option value="South Dakota">SD</option>
                                        <option value="Tennessee">TN</option>
                                        <option value="Texas">TX</option>
                                        <option value="Utah">UT</option>
                                        <option value="Vermont">VT</option>
                                        <option value="Virginia">VA</option>
                                        <option value="Washington ">WA</option>
                                        <option value="West Virginia">WV</option>
                                        <option value="Wisconsin">WI</option>
                                        <option value="Wyoming">WY</option>
                                    </select>
                                    <label for="txtRegisterState" class="text-black" aria-label="State">State</label>
                                    <div id="errRegisterState" class="emsg"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col">             
                            <div class="form-floating mb-3" required length="5">
                                <input id="txtRegisterZip" class="form-control" placeholder="Zip Code" onfocusout="check(document.getElementById('txtRegisterZip'), document.getElementById('errRegisterZip') )" required minlength="1">
                                <label for="txtRegisterZip" class="form-label text-black" aria-label="Zip Code">Zip Code</label>
                                <div id="errRegisterZip" class="emsg"></div>    
                            </div>
                        </div>
                    </div>

                    <button id="btnRegister" type="button" class="btn btn-primary col-12 mt-4">Register</button>
                    <button type="button" id="btnClear" class="btn btn-danger col-12 mt-4">Clear</button>
                    
                    <div class="text-center mt-4">
                        <a href="#" onclick="return false;" id="btnReturn"> Return </a>
                    </div>
                </form>
            </div>
        </div>

        <!--About Card-->
        <div id="divAbout" class="card col-10 col-md-8 col-lg-6 mt-3" style="display: none;">
            <div class="card-header">
                <h2 class="text-center">About</h2>
            </div>

            <div class="card-body">
                 <!-- Deprecated About Page, can be repurposed later

                <p>Welcome to the web app for Smart Chicken Coops by SwollenHippo! You can use this app to register with your Coop ID and interact with your Smart Coop.</p>
                <h3>Programmers</h3>
                <ul>
                    <li>Ethan Dixon</li>
                    <li>Gage Jones</li>
                    <li>Colton Sellner</li>
                    <li>Kevin Ulrich</li>
                    <li>Sam Warren</li>
                </ul>
                <h3>Product Owner</h3>
                <p>Ben Burchfield</p> -->
                <div class="text-center">
                    <a href="#" onclick="return false;" id="btnReturnLogin">Return</a>
                </div>
            </div>
        </div>

        <!--Dashboard -->
        <div id="divDashboard" class="card col-10 col-md-8 col-lg-6 mt-3" style="display: none;">
            <div class="card-header">
                <h2 class="text-center font-weight-bold;">Dashboard</h2>
            </div>

            <div class="card-body">
                <div class="row row-cols-2 mb-3">
                    <div class="col">
                        <h3 class="text-center">Eggs</h3>
                        
                        <button type="button" class="btn btn-primary col-12" data-bs-toggle="modal" data-bs-target="#eggModal">Add harvest</button>
                    </div>
                    <div>
                        <canvas id="eggChart" width="400" height="200"></canvas>
                    </div class="col">
                </div>

                <h3>Environment</h3>
                <table id="tblEnvironment" class="table table-striped w-auto">
                    <thead>
                        <th>Observation Date and Time</th>
                        <th>Temperature</th>
                        <th>Humidity</th>
                    </thead>
                    <tbody>
                        
                    </tbody>
                    
                </table>
                <p id="pNoObservations" class="text-center">No Current Observations</p>
            </div>

            <button id="settingsLink" class="btn btn-link" onclick="openSettings()">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal settings-box" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Door Times Setting -->
                    <div class="col-md-5">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Door Times</h5>
                                <div class="form-group">
                                    <label for="doorOpenTime">Open Time:</label>
                                    <input type="time" class="form-control" id="doorOpenTime" name="doorOpenTime">
                                </div>
                                <div class="form-group">
                                    <label for="doorCloseTime">Close Time:</label>
                                    <input type="time" class="form-control" id="doorCloseTime" name="doorCloseTime">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other Settings (Fan Temperature, Heater Temperature) -->
                    <div id="otherSettingsContainer" class="col-md-7">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Other Settings</h5>
                                <div class="row">
                                    <!-- Fan Temperature Setting -->
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="fanTemperature">Fan Temperature (&deg;F):</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="adjustTemperature('fanTemperature', -1)">-</button>
                                                </div>
                                                <input type="number" class="form-control" id="fanTemperature", name="fanTemperature" value="68">
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="adjustTemperature('fanTemperature', 1)">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Heater Temperature Setting -->
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="heaterTemperature">Heater Temperature (&deg;F):</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="adjustTemperature('heaterTemperature', -1)">-</button>
                                                </div>
                                                <input type="number" class="form-control" id="heaterTemperature" name="heaterTemperature" value="74">
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="adjustTemperature('heaterTemperature', 1)">+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Door Status Setting -->
                    <div class="row mt-md-0 mt-3" style="padding-left: 35px;">
                        <div class="col-md-12 d-flex justify-content-center">
                            <div class="card border-top-0" style="width: 1600px;">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Door Status</h5>
                                    <div class="form-group">
                                        <label>Status:</label>
                                        <span id="doorStatusIndicator">Closed</span>
                                    </div>
                                    <button id="doorActionButton" type="button" class="btn btn-primary mt-2" onclick="toggleDoor()">Open Door</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Save changes</button>
            </div>
        </div>
    </div>
</div>

    <!--Leftside Leftside Leftside (Google it if you don't get the reference)-->
    <div id="divEnvironment" class="card col-4 mt-3 mb-3 mx-3" style="display: none;">
        <div class="card-body text-white font-weight-bold" style=" background-image: url('images/clearSkies.jpg'); background-size: cover;">
            <h2 class="card-title text-bold" style="background-color: rgba(0, 0, 0, 0.5);">Conditions in <span id="spanLocation"></span></h3>
            <p style="background-color: rgb(0, 0, 0, 0.5);">Temp: <span id="spanCurrentTemp">--</span></p>
            <p style="background-color: rgb(0, 0, 0, 0.5);">Humidity: <span id="spanCurrentHumidity">--</span>%</p>
            <button id="btnRefresh" class="btn btn-secondary col-6 offset-3" type="button">Refresh</button>
        </div>
    </div>

    <audio id="audio" loop></audio>
    <button id="audioButton" onclick="toggleAudio()" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <img src="images/noSound.png" id="noSoundImage" />
        <img src="images/sound.png" id="soundImage" style="display:none;" />
    </button>

    <!--Egg Modal (popup)-->
    <div class="modal fade" id="eggModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Add harvest</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <label for="txtEggs" class="form-label">Enter the number of eggs collected</label>
                        <input id="txtEggs" class="form-control" placeholder="12" type="number">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnLogEggs">Log harvest!</button>
                </div>
            </div>
        </div>
    </div>

    <!--START OF JAVASCRIPT-->

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>  
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        //This is the ID we generated:
        //UYHIR9L2

        //The following id is for OpenWeather. It was generated under Colton's account
        const strOpenWeatherID = "";

         //The following id is for GoogleMaps. It was generated under Gage's account
         const strGoogleMapsID = "";

        /*
            function: UpdateDivEnvironment
            parameters: none
            purpose: This function finds the weather at the address that the user entered.
        */
        function UpdateDivEnvironment() {
            //First, get the email from the session ID
            var strSessionID = localStorage.getItem('SessionID');
            $.get('https://simplecoop.swollenhippo.com/sessions.php', {SessionID: strSessionID}, function(result){
                result = JSON.parse(result);
                //Debugging statement to check result
                //console.log(result);

                //Second, get the user's address
                $.get('https://simplecoop.swollenhippo.com/useraddress.php', {Email: result.Email}, function(resultAddress){
                    resultAddress = JSON.parse(resultAddress);
                    //Debugging statement to verify address
                    //console.log(resultAddress);

                    let strZip = resultAddress.ZIP + ",US";

                    //Debugging statement to verify ZIP code
                    //console.log(strZip)

                    //Third, find latitude and longitude based on ZIP code for weather
                    $.get('http://api.openweathermap.org/geo/1.0/zip', {zip:strZip, appid: strOpenWeatherID}, function(latLonResult){
                        //Debugging statement to verify latitude and longitude
                        //console.log(latLonResult);

                        const latitude = latLonResult.lat;
                        const longitude = latLonResult.lon;

                        /* dateTimeZip(latitude, longitude, strZip) //Displays the current Date and Time at the User's Zip Code
                            .then(dateTime => {
                                console.log('Date:', dateTime.date);
                                console.log('Time:', dateTime.time);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            }); */

                        $.get('https://api.openweathermap.org/data/2.5/weather', {lat:latLonResult.lat,lon:latLonResult.lon,appid:strOpenWeatherID,units:'imperial'},function(weatherResult){
                            //debugging statement to verify the weather returned from OpenWeather
                            //console.log(weatherResult);
                            $('#spanLocation').empty(); //remove all children in divLocation
                            $('#spanCurrentTemp').empty(); //remove all children in spanCurrentTemp
                            $('#spanCurrentHumidity').empty(); //remove all children in spanCurrentHumidity
                            $('#spanLocation').append(resultAddress.City);
                            $('#spanCurrentTemp').append(weatherResult.main.temp);
                            $('#spanCurrentHumidity').append(weatherResult.main.humidity);
                        })
                    })
                })
            })

            
        }

        /*
                $('#btnHamburger').on('click', function() {
                    $('#divNavButtons').slideToggle();
                })
        */
        $('#btnAbout').on('click',function(){
            $('#divNavButtons').slideToggle();
            //Slide Login or Register card before sliding About card down
            var userLoc;
            if ($('#divLogin').is(':visible')) {
                userLoc = 'login';
                $('#divLogin').slideUp();
            } else if ($('#divRegister').is(':visible')) {
                userLoc = 'register';
                $('#divRegister').slideUp();
            } else if ($('#divDashboard').is(':visible')) {
                userLoc = 'dashboard';
                $('#divDashboard').slideUp();
                $('#divEnvironment').slideUp();                
            }   else {
                userLoc = sessionStorage.getItem('userLoc');
                }
            console.log(userLoc);
            setUserLocation(userLoc);
            $('#divAbout').slideDown();
        })

        $('#btnReturnLogin').on('click',function(){
            $('#divAbout').slideUp();
            var userLoc = sessionStorage.getItem('userLoc');
            console.log(userLoc);
            switch (userLoc) {
                case 'dashboard':
                    $('#divDashboard').slideDown();
                    $('#divEnvironment').slideDown();   
                    break;
                case 'registration':
                    $('#divRegistration').slideDown;
                    break;
                case 'login':          
                    $('#divLogin').slideDown();
                    break;
                default:
                    break;
            }
        })

        $('#btnLogin').on('click',function(){
            let strUsername = $('#txtLoginUsername').val();
            let strPassword = $('#txtLoginPassword').val();

            if(strUsername.length < 1 || strPassword.length < 1){
                Swal.fire({
                    title: "Oops!",
                    html: '<p>Email and Password cannot be blank</p>',
                    icon: "error"
                })
            } else {

                $.post('https://simplecoop.swollenhippo.com/sessions.php', {Email: strUsername, Password: strPassword}, function(result){
                    result = JSON.parse(result);
                    console.log(result);

                    if(result.Outcome != 'false') {
                        sessionStorage.setItem('SessionID',result.SessionID);
                        localStorage.setItem('SessionID', result.SessionID);

                        $('#btnLogout').show();
                        //$('#divNavbar').slideUp();
                        $('#divLogin').slideUp(function(){
                            $('#divDashboard').slideDown();
                            $('#divEnvironment').show();
                            //fetchEnvironmentData();
                        });

                        UpdateDivEnvironment();
                        fillTable();

                    } else {
                        Swal.fire({
                            title: "Oops!",
                            html: '<p>Invalid username and/or password</p>',
                            icon: "error"
                        })
                    }                    
                });
            }
        })

        $('#btnRegister').on('click',function(){
            //define string variables to hold user input on the registration card
            let strUsername = $('#txtRegisterUsername').val();
            let strPassword = $('#txtRegisterPassword').val();
            let strFirstName = $('#txtRegisterFirstName').val();
            let strLastName = $('#txtRegisterLastName').val();
            let strEmail = $('#txtRegisterEmail').val();
            let strPhone = $('#numRegisterPhone').val();
            let phoneRegex = /^[0-9]{3}-[0-9]{3}-[0-9]{4}$/;
            let strCoopID = $('#txtRegisterCoopID').val();
            let strStreetAddress1 = $('#txtRegisterStreetAddress1').val();
            let strStreetAddress2 = $('#txtRegisterStreetAddress2').val();
            let strCity = $('#txtRegisterCity').val();
            let strState = $('#txtRegisterState').val();
            let strZip = $('#txtRegisterZip').val();

            let blnError = false; //This is set to true if the user entered something incorrect
            let strErrorMsg = ""; //Error messages are concatenated to this string

            if (strUsername < 1) {
                blnError = true;
                strErrorMsg += "Username cannot be blank. ";
            }
            if (strPassword < 1) {
                blnError = true;
                strErrorMsg += "Password cannot be blank. ";
            }
            if (strFirstName < 1) {
                blnError = true;
                strErrorMsg += "First name cannot be blank. ";
            }
            if (strLastName < 1) {
                blnError = true;
                strErrorMsg += "Last name cannot be blank. ";
            }
            if (strEmail < 1) {
                blnError = true;
                strErrorMsg += "Email cannot be blank. ";
            }
            if (strPhone < 1) {
                blnError = true;
                strErrorMsg += "Phone number cannot be blank. ";
            }

            if (!phoneRegex.test(strPhone)) {
                blnError = true;
                strErrorMsg += "Phone number is not valid, please use the format xxx-xxx-xxxx.  "
            }

            if (strCoopID < 1) {
                blnError = true;
                strErrorMsg += "Coop ID cannot be blank. ";
            }
            
            if (strStreetAddress1 < 1) {
                blnError = true;
                strErrorMsg += "Street address 1 cannot be blank. ";
            }
            //Street address 2 is not necessary
            if (strCity < 1) {
                blnError = true;
                strErrorMsg += "City cannot be blank. ";
            }
            if (strState < 1) {
                blnError = true;
                strErrorMsg += "State cannot be blank. ";
            }
            if (strZip < 1) {
                blnError = true;
                strErrorMsg += "Zip code cannot be blank. ";
            }

            if (blnError) { //if there was incorrect input
                Swal.fire({
                    title: "Oops!",
                    html: '<p>' + strErrorMsg + '</p>',
                    icon: "error"
                });
            } else {
                //create new user with users.php
                $.post('https://simplecoop.swollenhippo.com/users.php', {Email: strEmail, Password: strPassword, FirstName: strFirstName, LastName: strLastName, CoopID: strCoopID},function(result){
                    result = JSON.parse(result);
                    console.log(result);

                    if (result.Outcome == 'New User Created') {
                        //create a session ID
                        $.post('https://simplecoop.swollenhippo.com/sessions.php', {Email: strEmail, Password: strPassword}, function(sessionResult){
                            sessionResult = JSON.parse(sessionResult);
                            console.log(sessionResult);

                            sessionStorage.setItem('SessionID',sessionResult.SessionID);
                        });

                        //record user's address
                        $.post('https://simplecoop.swollenhippo.com/useraddress.php', {Email: strEmail, Street1: strStreetAddress1, Street2: strStreetAddress2, City: strCity, State: strState, ZIP: strZip}, function(result){
                            console.log(result);
                            UpdateDivEnvironment();
                        });

                        //show dashboard
                        //$('#divNavbar').slideUp();
                        $('#divRegister').slideUp(function(){
                            $('#divDashboard').slideDown();
                            $('#divEnvironment').show("slide", { direction: "right" }, 1000)
                        });

                        fillTable();
                        
                    } else { //user could not register
                        Swal.fire({
                            title: "Oops!",
                            html: '<p>Registration failed</p>',
                            icon: "error"
                        });
                    }
                })
            }
            var observationDateTime = getTime();
            
            console.log(observationDateTime);
        })
            

        $('#txtRegisterEmail').focusout(function() {
            let value = $('#txtRegisterEmail').val();
            let emailRegEx = new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");
            if(!emailRegEx.test(value)) {
                $('#txtRegisterEmail').addClass('err');
                $('#errRegisterEmail').text('Please Enter a Valid Email');
            } else {
                $('#txtRegisterEmail').removeClass('err');
                $('#errRegisterEmail').text('');
            }
        }) 


        $('#btnToggle').on('click',function(){
            $('#divLogin').slideUp(function(){
                $('#divRegister').slideDown();
            })
        })

        $('#btnReturn').on('click',function(){
            $('#divRegister').slideUp(function(){
                $('#divLogin').slideDown();
          })
        })

        $('#btnClear').on('click',function(){
            $('#txtRegisterUsername').val( '')
            $('#txtRegisterPassword').val( '')
            $('#txtRegisterFirstName').val( '')
            $('#txtRegisterLastName').val( '')
            $('#txtRegisterEmail').val( '')
            $('#numRegisterPhone').val( '')
            $('#txtRegisterCoopID').val( '')
            $('#txtRegisterStreetAddress1').val( '')
            $('#txtRegisterStreetAddress2').val( '')
            $('#txtRegisterCity').val( '')
            $('#txtRegisterState').val( '')
            $('#txtRegisterZip').val( '')

        })

        function recordEggHarvest(intEggs) {
            let sessionID = sessionStorage.getItem('SessionID');
            //let observationDate = getDate();
            //let observationTime = getTime();
            var currentDate = new Date();
            currentDate = currentDate.toISOString()
            //Debugging statements
            //console.log(sessionID)
            //console.log(currentDate);
            //console.log(intEggs)

            $.post('https://simplecoop.swollenhippo.com/eggs.php', {SessionID:sessionID, observationDateTime:currentDate, eggs:intEggs}, function(result) {
                result = JSON.parse(result);
                //console.log(result);
                if (result.LogID) {
                    Swal.fire({
                        title:"Success!",
                        html:"<p>harvest logged</p>",
                        icon:"success"
                    })
                } else {
                    Swal.fire({
                        title: "Oops!",
                        html: '<p>Egg harvest recorded failed</p>',
                        icon: "error"
                    })
                }
            });
        }

        $("#btnLogEggs").on('click',function(){
            let strEggs = $("#txtEggs").val();
            //Debugging statement to check the value entered by the user
            //console.log(strEggs);

            if (strEggs) {
                recordEggHarvest(strEggs);
            } else {
                Swal.fire({
                    title: "Oops!",
                    html: '<p>Number of eggs not provided</p>',
                    icon: "error"
                })
            }
        })

        /*
            function: UpdateEggInfo
            parameters: none
            purpose: This function updates the lifetime eggs harvested and egg graph.
        */
        /* function updateEggInfo() {
            console.log("here")
            let strSessionID = sessionStorage.getItem('SessionID');
            $.getJSON('https://simplecoop.swollenhippo.com/eggs.php', {SessionID:strSessionID, days:'7'}, function(result){
                console.log(result);
            })
        } */

        $(document).ready(function() {
            // Check if SessionID exists in localStorage
            var sessionID = localStorage.getItem('SessionID');
            if (sessionID) {
                sessionStorage.setItem('SessionID', sessionID);
                $('#divLogin').hide();
                $('#divDashboard').slideDown();
                $('#divEnvironment').slideDown();
                $("#btnLogout").show()
                UpdateDivEnvironment();
                updateEggInfo();
                fillTable();
                
            }
            
        })

        function check(a,b){
          // init
          var valid = true;

          let field = a;
          let error = b;
          if (!field.checkValidity()) {
            valid = false;
            field.classList.add("err");
            error.innerHTML = " Please Enter a valid input\r\n ";
          } else {
            field.classList.remove("err");
            error.innerHTML = "";
          }
        
          return valid;
        }

        $('#txtLoginPassword').keypress(function(event) {
            if(event.which === 13){
                $('#btnLogin').click();
            }
        });

        $('#txtEggs').keypress(function(event) {
            if(event.which === 13){
                event.preventDefault();
                $('#btnLogEggs').click();
            }
        });

        $('#btnRefresh').on('click', function(){
            UpdateDivEnvironment();
        })

        /* function getEnvironmentData(){
            $.get('http://localNode.com/check-weather/', function(data) {
            //pretending to get a JSON file
            $('#currentTemp').text(data.temperature);
                $('#currentHumidity').text(data.humidity);
            });
        } */

        $('#btnLogout').on('click', function(){
            let strSessionID = sessionStorage.getItem('SessionID');
            sessionStorage.removeItem('SessionID');
            localStorage.removeItem('SessionID');
            $.ajax({
                url: 'https://simplecoop.swollenhippo.com/sessions.php',
                type: 'DELETE',
                data: strSessionID
            })
            $('#btnLogout').hide();
            window.location.reload();
            setUserLocation('login');
        });

         /*
            function: dateTimeZip
            parameters: latitude, longitude, strZip
            purpose: This function takes the latitude, longitude, and zip code, and outputs the date and time at the location.
        */
        function dateTimeZip(latitude, longitude, strZip) {
            return new Promise((resolve, reject) => { //Setting up support for catch block

            const timeStamp = Math.floor(Date.now() / 1000); // Convert milliseconds to seconds
            const timeZoneApiUrl = `https://maps.googleapis.com/maps/api/timezone/json?location=${latitude},${longitude}&timestamp=${timeStamp}&key=${strGoogleMapsID}`;
            fetch(timeZoneApiUrl)
                .then(response => { //Checks if timezone data can be fetched
                    if (!response.ok) {
                        throw new Error('Failed to fetch timezone data');
                    }
                    return response.json();
                })
                .then(timezoneData => { //Checks if API responds or not
                    if (timezoneData.status !== 'OK') {
                        throw new Error('Invalid response status from Google Maps API');
                    }
                    if (!timezoneData.timeZoneId) { //Checks if the program can find the Timezone ID
                        throw new Error('Timezone ID not found in response');
                    }

                    const timeZoneId = timezoneData.timeZoneId;

                    //Get current date and time in the location's timezone
                    const dateTimeApiUrl = `https://worldtimeapi.org/api/timezone/${timeZoneId}`;
                    return fetch(dateTimeApiUrl);
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch date and time data');
                    }
                    return response.json();
                })
                .then(data => { //Orders the dates and makes things prettier
                    const time = new Date(data.datetime);
                    const monthName = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                    const month = monthName[time.getMonth()];
                    const day = time.getDate();
                    const year = time.getFullYear();
                    const suffix = getSuffix(day); // Get the suffix for the day

                    const formattedDate = `${month} ${day}${suffix} ${year}`;
                    const formattedTime = `${time.getHours()}:${time.getMinutes()}:${time.getSeconds()}`;

                    resolve({ date: formattedDate, time: formattedTime });
                })
                .catch(error => reject(error)); // Resolve or reject the promise based on the catch block
            });
        } 

        /*
            function: getDate
            parameters: none
            purpose: This function displays the current Date
        */
        function getDate() {
            var time = new Date();
            var monthName = ["Janurary", "February", "March", "April", "May", "June", 
                             "July", "August", "September", "October", "November", "December"];
                    
            var year = time.getFullYear();
            var month = monthName[time.getMonth()];
            var day = time.getDate();

            var orderedDate = month + " " + day + getSuffix(day) + " " + year;
            return orderedDate;
        }

        /*
            function: getTime
            parameters: none
            purpose: This function displays the current Time
        */
        function getTime() {
            var time = new Date();
            var hours = time.getHours();
            var minutes = time.getMinutes();
            var seconds = time.getSeconds();

            hours = (hours < 10) ? "0" + hours : hours;
            minutes = (minutes < 10) ? "0" + minutes : minutes;
            seconds = (seconds < 10) ? "0" + seconds : seconds;
            var orderedTime = hours + ":" + minutes + ":" + seconds;
            return orderedTime
        }

        //Function in charge of setting the correct suffix for the date functions
        function getSuffix(day) {
            if (day >=11 && day <= 13) {
                return "th";
            }

            switch (day % 10) {
                case 1: return "st";
                case 2: return "nd";
                case 3: return "rd";
                default: return "th";
            }
        }

        var audio = document.getElementById("audio");
        var audioButton = document.getElementById("audioButton");
        var soundImage = document.getElementById("soundImage");
        var noSoundImage = document.getElementById("noSoundImage");

        var songs = ["images/song1.mp3", "images/song2.mp3"]; 
        var currentSongIndex = 0;

        // Load initial song
        audio.src = songs[currentSongIndex];

        // Function to toggle audio playback and update button images
        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                soundImage.style.display = "block";
                noSoundImage.style.display = "none";
            } else {
                audio.pause();
                soundImage.style.display = "none";
                noSoundImage.style.display = "block";
            }
        }

        // Event listener to switch to the next song when the current one ends
        audio.addEventListener("ended", function() {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            audio.src = songs[currentSongIndex];
            audio.play();
        });


        function checkCapsLock(event) {
            const capsLockOn = event.getModifierState && event.getModifierState('CapsLock');
            const passwordInput = document.getElementById('txtLoginPassword');
            const capsLockWarning = document.getElementById('capsLockWarning');

            if (capsLockOn && passwordInput === document.activeElement) {
                capsLockWarning.style.display = 'block';
            } else {
                capsLockWarning.style.display = 'none';
            }
        }

        // Attach event listener to the password input
        document.getElementById('txtLoginPassword').addEventListener('keypress', checkCapsLock);


        // Get the modal
    var modal = document.getElementById("settingsModal");

// Get the link that opens the modal
var link = document.getElementById("settingsLink");


// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the link, open the modal 
function openSettings() {
    modal.style.display = "block";
    getSettings();
}

// When the user clicks on <span> (x), close the modal
span.onclick = function () {
    modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function (event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

        

function saveSettings() {
        // Get values from input fields
        var doorOpenTime = $('#doorOpenTime').val();
        var doorCloseTime = $('#doorCloseTime').val();
        var doorStatusIndicator = document.getElementById('doorStatusIndicator').innerText;
        var fanTemperature = $('#fanTemperature').val();
        var heaterTemperature = $('#heaterTemperature').val();
        var settingsURL = ('https://simplecoop.swollenhippo.com/settings.php');

        var doorStatus = doorStatusIndicator === 'Open' ? 'Open' : 'Closed';

        var strSessionID = sessionStorage.getItem('SessionID');

        console.log({
                Door_Open: doorOpenTime,
                Door_Close: doorCloseTime,
                Door_Status: doorStatus,
                Fan_Temp: fanTemperature,
                Heater_Temp: heaterTemperature
            });

            /*
        var postSettings = {
            SessionID: sessionStorage.getItem('SessionID'),
            setting: "Door_Open_Time",
            value: doorOpenTime
        }

        //Saves Settings 
        $.post(settingsURL, postSettings, function(result) {
            // Handle the response
            console.log('Response:', result);
            console.log("Successfully saved settings")
        }).fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log("Failed to save settings")
        });

        var postSettings = {
            SessionID: sessionStorage.getItem('SessionID'),
            setting: "Door_Close_Time",
            value: doorCloseTime
        }

        //Saves Settings 
        $.post(settingsURL, postSettings, function(result) {
            // Handle the response
            console.log('Response:', result);
            console.log("Successfully saved settings")
        }).fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log("Failed to save settings")
        });

        var postSettings = {
            SessionID: sessionStorage.getItem('SessionID'),
            setting: "Door_Status",
            value: doorStatus
        }

        //Saves Settings 
        $.post(settingsURL, postSettings, function(result) {
            // Handle the response
            console.log('Response:', result);
            console.log("Successfully saved settings")
        }).fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log("Failed to save settings")
        });

        var postSettings = {
            SessionID: sessionStorage.getItem('SessionID'),
            setting: "Fan_Temperature",
            value: fanTemperature
        }

        //Saves Settings 
        $.post(settingsURL, postSettings, function(result) {
            // Handle the response
            console.log('Response:', result);
            console.log("Successfully saved settings")
        }).fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log("Failed to save settings")
        });

        var postSettings = {
            SessionID: sessionStorage.getItem('SessionID'),
            setting: "Heat_Temperature",
            value: heaterTemperature
        }

        //Saves Settings 
        $.post(settingsURL, postSettings, function(result) {
            // Handle the response
            console.log('Response:', result);
            console.log("Successfully saved settings")
        }).fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log("Failed to save settings")
        });*/
    

    $.ajax({
        url: settingsURL,
        type: 'PUT', // Specify the HTTP method as PUT
        data: {
            SessionID: strSessionID,
            setting: "Door_Open_Time",
            value: doorOpenTime
        },
        success: function(result) {
            // Handle the success response
            console.log('Response:', result);
            console.log('Successfully saved settings');
        },
        error: function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log('Failed to save settings');
        }
    });
    $.ajax({
        url: settingsURL,
        type: 'PUT', // Specify the HTTP method as PUT
        data: {
            SessionID: strSessionID,
            setting: "Door_Close_Time",
            value: doorCloseTime
        },
        success: function(result) {
            // Handle the success response
            console.log('Response:', result);
            console.log('Successfully saved settings');
        },
        error: function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log('Failed to save settings');
        }
    });

    $.ajax({
        url: settingsURL,
        type: 'PUT', // Specify the HTTP method as PUT
        data: {
            SessionID: strSessionID,
            setting: "Door_Status",
            value: doorStatus
        },
        success: function(result) {
            // Handle the success response
            console.log('Response:', result);
            console.log('Successfully saved settings');
        },
        error: function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log('Failed to save settings');
        }
    });

    $.ajax({
        url: settingsURL,
        type: 'PUT', // Specify the HTTP method as PUT
        data: {
            SessionID: strSessionID,
            setting: "Fan_Temperature",
            value: fanTemperature
        },
        success: function(result) {
            // Handle the success response
            console.log('Response:', result);
            console.log('Successfully saved settings');
        },
        error: function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log('Failed to save settings');
        }
    });

    $.ajax({
        url: settingsURL,
        type: 'PUT', // Specify the HTTP method as PUT
        data: {
            SessionID: strSessionID,
            setting: "Heat_Temperature",
            value: heaterTemperature
        },
        success: function(result) {
            // Handle the success response
            console.log('Response:', result);
            console.log('Successfully saved settings');
        },
        error: function(xhr, status, error) {
            // Handle the failure
            console.error('Error:', error);
            console.log('Failed to save settings');
        }
    });
}

    // Send a GET request to retrieve settings
    function getSettings(){
        var doorOpenTime = $('#doorOpenTime').val();
        var doorCloseTime = $('#doorCloseTime').val();
        var doorStatusIndicator = document.getElementById('doorStatusIndicator').innerText;
        var fanTemperature = $('#fanTemperature').val();
        var heaterTemperature = $('#heaterTemperature').val();
        var settingsURL = ('https://simplecoop.swollenhippo.com/settings.php');

        var doorStatus = doorStatusIndicator === 'Open' ? 'Open' : 'Closed';

        var strSessionID = sessionStorage.getItem('SessionID');
        
        var settingsData = [doorOpenTime, doorCloseTime, doorStatus, fanTemperature, heaterTemperature];

    $.get(settingsURL, { SessionID: strSessionID, setting: "Door_Open_Time"})
        .done(function(response) {
            // Handle the successful response
            response = JSON.parse(response);
            console.log();
            console.log('Settings retrieved successfully:', response);
            $('#doorOpenTime').val(response.Value);
        })
        .fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error retrieving settings:', error);
            // Use default settings instead
            const defaultSettings = {
                doorOpenTime: '09:00',
                doorCloseTime: '17:00',
                doorStatus: 'Closed',
                fanTemperature: '72',
                heaterTemperature: '68'
            };
            updateSettingsUI(defaultSettings);
        });

        $.get(settingsURL, { SessionID: strSessionID, setting: "Door_Close_Time"})
        .done(function(response) {
            // Handle the successful response
            response = JSON.parse(response);
            console.log();
            console.log('Settings retrieved successfully:', response);
            $('#doorCloseTime').val(response.Value);
        })
        .fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error retrieving settings:', error);
            // Use default settings instead
            const defaultSettings = {
                doorOpenTime: '09:00',
                doorCloseTime: '17:00',
                doorStatus: 'Closed',
                fanTemperature: '72',
                heaterTemperature: '68'
            };
            updateSettingsUI(defaultSettings);
        });

        $.get(settingsURL, { SessionID: strSessionID, setting: "Door_Status"})
        .done(function(response) {
            // Handle the successful response
            response = JSON.parse(response);
            console.log();
            console.log('Settings retrieved successfully:', response);
            $('#doorStatus').val(response.Value);
        })
        .fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error retrieving settings:', error);
            // Use default settings instead
            const defaultSettings = {
                doorOpenTime: '09:00',
                doorCloseTime: '17:00',
                doorStatus: 'Closed',
                fanTemperature: '72',
                heaterTemperature: '68'
            };
            updateSettingsUI(defaultSettings);
        });

        $.get(settingsURL, { SessionID: strSessionID, setting: "Fan_Temperature"})
        .done(function(response) {
            // Handle the successful response
            response = JSON.parse(response);
            console.log();
            console.log('Settings retrieved successfully:', response);
            $('#fanTemperature').val(response.Value);
        })
        .fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error retrieving settings:', error);
            // Use default settings instead
            const defaultSettings = {
                doorOpenTime: '09:00',
                doorCloseTime: '17:00',
                doorStatus: 'Closed',
                fanTemperature: '72',
                heaterTemperature: '68'
            };
            updateSettingsUI(defaultSettings);
        });

        $.get(settingsURL, { SessionID: strSessionID, setting: "Heat_Temperature"})
        .done(function(response) {
            // Handle the successful response
            response = JSON.parse(response);
            console.log();
            console.log('Settings retrieved successfully:', response);
            $('#heaterTemperature').val(response.Value);
        })
        .fail(function(xhr, status, error) {
            // Handle the failure
            console.error('Error retrieving settings:', error);
            // Use default settings instead
            const defaultSettings = {
                doorOpenTime: '09:00',
                doorCloseTime: '17:00',
                doorStatus: 'Closed',
                fanTemperature: '72',
                heaterTemperature: '68'
            };
            updateSettingsUI(defaultSettings);
        });
    }


    function fillTable() {
        let strSessionID = sessionStorage.getItem('SessionID');
        $.getJSON('https://simplecoop.swollenhippo.com/environment.php', {SessionID: strSessionID, days: '999'}, function(result) {
            if(result.length > 0) {
                $('#pNoObservations').hide();
                result.forEach(function(observation) {
                    let strRow = `<tr><td>${observation.ObservationDateTime}</td><td>${observation.Temperature}</td><td>${observation.Humidity}</td></tr`;
                    $('#tblEnvironment, tbody').append(strRow);
                });

            }

            $('#tblEnvironment').DataTable({
                "order": [[0, 'dsc']]
            });

        })
    }  


    //Function for the + and - buttons working to adjust the temperature in settings
    function adjustTemperature(elementId, step) {
        var inputElement = document.getElementById(elementId);
        var currentValue = parseInt(inputElement.value);
        var newValue = currentValue + step;
        inputElement.value = newValue;
    }

    //Function to tell the button in settings if the status of the Door is Opened or Closed, and what the button should say
    function toggleDoor() {
        var doorStatus = document.getElementById('doorStatusIndicator');
        var doorActionButton = document.getElementById('doorActionButton');
        
        if (doorStatus.innerText === 'Closed') {
            doorStatus.innerText = 'Open';
            doorActionButton.innerText = 'Close Door';
            console.log('Door Opened')
        } else {
            doorStatus.innerText = 'Closed';
            doorActionButton.innerText = 'Open Door';
            console.log('Door Closed')
        }
    }


// result = JSON.parse(result);
    function updateEggInfo() {
    let strSessionID = sessionStorage.getItem('SessionID');

    // Make GET request to eggs.php
    $.get('https://simplecoop.swollenhippo.com/eggs.php', {SessionID: strSessionID, days: '7'}, function(result){
        result = JSON.parse(result);
        console.log('Data from eggs.php:', result);

        // Check if the result is empty or not an array
        if (!result || !Array.isArray(result)) {
            console.error('Invalid or empty response from server');
            return;
        }

        // Destroy existing chart if it exists
        if (window.myChart) {
            window.myChart.destroy();
        }

        // Process data and create chart
        let labels = [];
        let data = [];
        result.forEach(function(record) {
            // Assuming your JSON response has fields 'currentDate' and 'intEggs'
            labels.push(record.LogDateTime); 
            data.push(record.Harvested); 
        });

        // Create Chart.js chart
        let ctx = document.getElementById('eggChart').getContext('2d');
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Eggs Harvested',
                    data: data,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    });
}
    /* $(document).ready(function() {
        updateEggInfo();
    }); */

        //var currentDate = getDate();
        //var currentTime = getTime();
                
        //console.log(currentDate);
        //console.log(currentTime);

        function setUserLocation(location) {
        sessionStorage.setItem('userLoc', location);
        }







    </script>
</body>
</html>